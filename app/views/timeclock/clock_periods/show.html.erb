<% user_records = {} %>

<%= link_to "Back", timeclock_clock_periods_path, class: "btn btn-primary" %>

<% @clock_period.clock_records.each do |record| %>
  <% if user_records[%Q[#{record.user.id}]].blank? %>
    <% array = [record] %>
    <% user_records.store(%Q[#{record.user.id}], array) %>
  <% else %>
    <% user_records[%Q[#{record.user.id}]] << record  %>
  <% end %>
<% end %>

<%= form_for @clock_period, url: holiday_hours_path do |f| %>

<div class="modal" tabindex="-1" role="dialog" id="mynewModal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        Select Date for Holiday Entries
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>
            <%= f.datetime_field "start_date", { class: "form-control" } %>
            <%= f.submit "Create Holiday Entries", class: "form-control" %>
        </p>
      </div>
    </div>
  </div>
</div>

<table class="table table-striped table-bordered">
  <thead class="thead-dark">
    <tr>
      <th></th>
      <th>User</th>
      <th>Total</th>
      <th>Links</th>
      <th>Sun</th>
      <th>Mon</th>
      <th>Tue</th>
      <th>Wed</th>
      <th>Thu</th>
      <th>Fri</th>
      <th>Sat</th>
    </tr>
  </thead>
  <tbody>
  <% user_records.each do |user, records| %>
    <% week_rec = nil %>
    <% week_totals = nil %>
    <% week_rec = records_to_weeks(records) %>
    <% week_totals = calc_week_totals(week_rec) %>
    <tr>
      <td><%= f.check_box "users", {:multiple => true}, user, nil %></td>
      <td><%= User.find(user).full_name %></td>
      <td><%= (week_totals.sum*4).round / 4.0 %> hrs</td>
      <td class="text-center">
        <%= link_to fa_icon('eye'),
            user_summary_path(:id => @clock_period.id, :user_id => user),
            :action => :user_summary, 
            data: {turbolinks: false}, 
            class: "font-weight-bold btn btn-sm btn-success" %>
      </td>
      <% week_totals.each do |hours| %>
      <th><%= (hours*4).round / 4.0 %> hrs</th>
      <% end %>
    </tr>
    <% end %>
  </tbody>
</table>
<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#mynewModal"> Create Holiday Shift for checked users </button>
<% end %>