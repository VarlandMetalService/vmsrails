<%= form_with model: @clock_record do |f| %>

  <div class="field hidden">
    <%= f.label :user_id %>
    <%= f.hidden_field :user_id, value: current_user.id %>
  </div>

  <div class="field hidden">
    <%= f.label :ip_address %>
    <%= f.hidden_field :ip_address, value: request.remote_ip %>
  </div>

  <div class="field hidden">
    <%= f.label :timestamp %>
    <%= f.datetime_select :timestamp %>
  </div>
  <div class="container-flex mt-4">
    <div class="row">
      <div class="col-3">
        <div class="card btn-block border-dark bg-dark">
          <div class="card-body bg-dark text-light text-center pb-0">
            <h5 class="card-title text-center">
            <%= current_user.full_name %></h5>
              Employee #<%=current_user.employee_number %>
              <hr style="border-color: #ffc107;">
              <strong class="text-light", id="clockx"></strong>
              <hr style="border-color: #ffc107;">
          </div>
          <ul class="list-group list-group-flush bg-dark">
            <% x = @period_records.order('timestamp asc').last.record_type unless 
            @period_records.blank? %>
            <% if x == "Start Work" || x == "End Break" %>
              <li class="list-group-item bg-dark">
                <input class="btn btn-primary btn-block btn-block2 py-4" type="submit", name="record_type", value="Start Break">
              </li>
              <li class="list-group-item bg-dark">
                <input class="btn btn-danger btn-block btn-block2 py-4" type="submit", name="record_type", value="End Work">
              </li>
            <% elsif x == "Start Break" %>
              <li class="list-group-item bg-dark">
              <input class="btn btn-info btn-block btn-block2 py-4" type="submit", name="record_type", value="End Break">
              </li>
            <% else %>
              <li class="list-group-item bg-dark">
              <input class="btn btn-success btn-block btn-block2 py-4" type="submit", name="record_type", value="Start Work">
              </li>
            <% end %>
          <% end %>
          </ul>
          <hr class="mr-3 ml-3" style="border-color: #ffc107;">
          <ul class="list-group list-group-flush bg-dark">
              <li class="list-group-item bg-dark text-white text-center">More</li>
              <li class="list-group-item bg-dark text-white text-center">Actions</li>
              <li class="list-group-item bg-dark text-white text-center">Here!</li>
              <li class="list-group-item bg-dark text-white text-center">Change Pin</li>
              <li class="list-group-item bg-dark text-white text-center">Something else</li>
              <li class="list-group-item bg-dark text-white text-center">Logout</li>
          </ul>
        </div>
      </div>
      <% week_recs = records_to_weeks(@period_records)%>
      <div class="col-9">
        <%= render partial: "calendar", locals: { :week_recs => week_recs } %>
      </div>
    </div>
  </div>
<body onload="StartTimerss(); startTime();" onmousemove="ResetTimerss();" onClick="ResetTimerss();"></body>
<script type="text/javascript">
    // Set timeout variables.
    var timoutNow = 10000;
    var timeoutTimer;

    // Start timers.
    function StartTimerss() {
        timeoutTimer = setTimeout("IdleTimeout()", timoutNow);
    };

    // Reset timers.
    function ResetTimerss() {
        clearTimeout(timeoutTimer);
        StartTimerss();
    };

    // Logout the user and auto reload or use this window.open('http://www.YourPageAdress.com', '_self'); to auto load a page.
    function IdleTimeout() {
        window.location = ('/logout');
    };

   function startTime() {
    y = "AM"
    var today = new Date();
    var h = today.getHours();
    var m = today.getMinutes();
    var s = today.getSeconds();
    var d = today.getDate();
    var t = today.getMonth()+1;
    var x = ""
    switch (today.getDay()) {
    case 0:
        x = "Sun";
        break;
    case 1:
        x = "Mon";
        break;
    case 2:
        x = "Tue";
        break;
    case 3:
        x = "Wed";
        break;
    case 4:
        x = "Thu";
        break;
    case 5:
        x = "Fri";
        break;
    case 6:
        x = "Sat";
}
    t = padTime(t);
    d = padTime(d);
    m = padTime(m);
    s = padTime(s);
    if (h > 12) {y = "PM"};
    h = checkHours(h);
    document.getElementById('clockx').innerHTML =
    x + " " + t + "/" + d + " - " + h + ":" + m + ":" + s + " " + y;
    var t = setTimeout(startTime, 500);
  }
  function padTime(i) {
    if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
    return i;
  }
  function checkHours(i) {
    if (i == 0) {i = 12};
    if (i < 10) {i = "0" + i};
    if (i > 12) {i = i - 12 };
    return i;
  }
</script>


